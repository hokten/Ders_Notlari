:imagesdir: Resimler
:figure-caption: Şekil
:listing-caption: Kod
:xrefstyle: full
:source-highlighter: highlightjs
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
= ASP.NET

== Yeni Bir ASP.NET MVC Projesi Oluşturma

Visual Studio 2015'de `File &#9658; New Project` menü yolunu izleyerek yeni bir ASP.NET 
MVC projesi oluşturmaya başlatabiliriz. Öncelikle karşımıza <<system_overview>> de görülen `New Project` 
dialog penceresi çıkacaktır. Visual Studio'da yeni bir proje oluştururken öncelikle 
kullanacağımız dili ve sonra ise projemizin şablonunun(tamplate) seçmemiz gerekir.Visual C# ile bir ASP.NET MVC porojesi
oluşturmak için `Templates &#9660; Visual C# &#9660; Web` seçeneğini seçmeliyiz.

image::yeni_mvc.png[#SimpleGroovyApp, title="Ratpack library"]

`New Project' dialog pencerisinin **Name** bölümüne projemizini ismi olan **Davetiye** metnini girelim ve OK 
butonuna tıklayalım. Sonra karşımıza <<initial_content>>'de görülen, farklı amaçlara göre hazırlanmış proje başlangıç 
şablonlarını seçebileceğiniz dialog penceresi çıkacaktır. Bu başlangıç şablonları ile kimlik doğrulama, görsel temalar ve 
site gezinme seçenekleri gibi bazı özellikleri projenize otomatik olarak ekleyebilirsiniz. Biz burada öncelikle basitlik için 
boş bir şablon kullanacağız. Sadece temel özelliklerin bulunduğu boş bir ASP.NET MVC şablonu oluşturmak için bu dialog 
penceresinin _Select a template_ bölümünden *Empty* seçilir ve  _Add folders and core references_ kısmında bulunan *MVC* 
seçeneği tiklenir. OK butonuna basıldığında en temel iskelete sahip bir ASP.NET MVC projesi oluşturmuş oluruz.

Projeniz oluştuğunda, projenize ait tüm dosyaların listelendiği Şekil'de gösterilen  _Solution Explorer_ 
panelinde bazı dosya ve klasörlerin otomatik olarak oluşturulduğunu göreceksiniz. Bu tüm MVC uygulamalarında bulunması 
gereken temel dosya ve klasörlerin olduğu varsayılan bir yapıdır.

Şimdi _Debug_ menüsünden *Start Debugging* öğesine tıklayarak uygulamanızı tarayıcıda deneyebilirsiniz. Öncelikle karşınıza, 
projeniz genelinde hata ayıklamanın özelliğinin aktif hale getireleceğini bildiren bir onay kutusu çıkacaktır. OK butonuna
basarak hata ayıklamayı aktif hale getirdiğimizde web tarayıcımız çalışacak ve Şekil'deki gibi bir sayfa gösterecektir. 
Uygulamamız *Empty* şablonu ile oluşturulduğundan herhangi bir içeriğe sahip değildir ve dolayısıyla tarayıcımız 
*404 Not Found Error* sayfasını karşımıza getirmiştir. Denemeniz bittiğinde tarayıcıyı kapatmalı veya Visula Studio'yu açıp 
_Debug_ menüsünden *Stop Debugging* seçeneğine tıklamalısınız. 
The overall architecture<<img-sunset>> of the system is show in <<SimpleGroovyApp>>t.
[#img-sunset]
.A mountain sunset
[link=http://www.flickr.com/photos/javh/5448336655]
image::yeni_mvc.jpg[Sunset,300,200]

== İlk Controller Ekleme
MVC mimarisinde gelen istekler kontrolörler tarafından tutulup işlenirler. ASP.NET kontrolörler, .NET çatısının temel 
kontrolör sınıfı olan _System.Web.MVC.Controller_ sınıfından türetilen bir C# nesnesidir. Bu nesnede yer alan her 
public methoda *action method* denir ve bu methodlar Web üzerinden URL'ler aracılığıyla bir eylemi gerçekleştirmek için 
çağırılırlar. Yeni oluşturulan kontrolörler, Visual Studio tarafından otomatik olarak projenin _Controllers_ klasörüne 
yerleştirilir. Şekilde görüldüğü gibi Yeni bir kontrolör oluşturmak için, _Solution Explorer_ panelinde _Controllers_ klasörüne 
sağ tıklanır ve `Add&#9658;Controller` menü yolu izlenir. 
Şekil
Sonrasında karşımıza Şekilde görülen `Add Scaffold` dialog penceresi çıkacaktır. Burada,  `MVC 5 Controller - Empty` seçeneği 
seçilip  `Add` butonuna basıldığında, bizeden oluşturacak olduğumuz kontrolörün ismini isteyen  `Add Controller` dialog 
penceresiyle karşımıza çıkacak. Kontrolörümüzün ismini `HomeController` olarak girip  `Add` butonuna bastığımızda 
yeni bir kontrolör eklemiş oluruz. Kontrolör isimlendirmesinde bazı genel kurallar vardır. Kontrolör ismi aslında kontrolörün 
amacına belirler. `Home` burada varsayılan kontrolör anlamına gelmektedir. 
Ayrıca kontrolör ismini  `Controller` son eki takip eder.

Bu işlemlerden sonra, Visual Studio projenin  _Controllers_ klasörü içinde  `HomeController.cs` isimli yeni bir dosya 
oluşturacaktır. Bu dosyayı açmak için çift tıklayın. <<MyScript>>, dosyanın varsayılan içeriği göstermektedir.
[[MyScript]]
[source, csharp, linenums, numbered]
.*HomeController.cs* dosyasının varsayılan içeriği.
----
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace PartyInvites.Controllers {
  public class HomeController : Controller { <1>
    public ActionResult Index() {
      return View(); 
    }
  }
}
----
<<MyScript>> kodunun (1) numaralı satırı dikkatle incelendiğinde, +HomeController+ sınıfının +System.Web.MVC+ isim uzayı 
içinde yer alan +Controller+ ana sınıfından türetildiği anlaşılabilir.
[[HomeControllercs_1]]
[source, csharp, linenums,subs="verbatim,quotes"]
.index.pg
----
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace PartyInvites.Controllers {
  public class HomeController : Controller {
    public [red yellow-background]*string*  Index() { <1>
      [red yellow-background]*return "Hello World";* <2>
    } 
  }
}
----
<<MyScript>> kodunu yeni hali <<HomeControllercs_1>> olacak şekilde değiştirelim. Bu yapılan küçük değşiklik ile, :q

== Routelar
Model, view, controllera ek olarak MVC uygulamaları da _route sistemini_ kullanırlar. 
Route sistemi, URLler ile controller ve action metodları arasındaki eşleşmelerden sorumludur. 
Visual Studio yeni bir MVC uygulaması oluşturulduğunda varsayılan olarak bazı routeları projeye ekler. 
Mesela, tarayıcıdan, `/`, `/Home` veya `/Home/Index` URLlerine istekte bulunduğunuzda, `HomeController` 
controllerının `Index` action metodu çağırılacaktır. 

Gerçekten örneğimizde tarayıcıda `http://localhost:portt`, `http://localhost:portt/Home` veya `http://localhost:portt/Home/Index` 
URLlerine istekte bulunduğunuzda, tarayıcının ekranda gösterdiği web sayfası, MVC uygulamamızdan çekilen _Hello World_ yazısından 
ibaret olacaktır.
[TIP]
====
Route sistemine ait ayarları projenizin `App_Start` klasörü içinde bulunan `RouteConfig.cs` dosyasını
düzenleyerek değiştirebilirsiniz.
====
== Web Sayfaları Üretip Çıktılamak
Örneğimizdeki çıktı olan _Hello World_ yazısı bir HTML çıktısı değil sadece bir metin çıktıdır. 
Tarayıcı isteklerine HTML cevapları verebilmek için _View_lar kullanılır. 

=== View Oluşturmak ve Çıktılamak
Bu işlem için öncelikle `HomeControlller.cs` dosyasındaki `Index` action metodunu <<HomeControllercs_2>> de vurgulandığı biçimde
düzenlemek olacaktır.
[[HomeControllercs_2]]
[source, csharp, linenums,subs="verbatim,quotes"]
.HomeController.cs dosyasında yer alan controller, bir view çıktılayacak şekilde değiştiriliyor.
----
using  <<HomeControllercs_2>>;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace PartyInvites.Controllers {
  public class HomeController : Controller {
    public [red yellow-background]*ViewResult*  Index() { <1>
      [red yellow-background]*return View();* <2>
    } 
  }
}
----
<<HomeControllercs_2>> kodunda değişen kısımlar sarı arkaplanlı olarak gösterilmiştir. 
Bir action metodunun `ViewResult` nesnesi döndürdümesi, MVC yapısına bir `View` çıktılanacağının talimatını vermesi demektir.
<<HomeControllercs_2>> kodunun (2) ile işaretlenmiş satırındaki `return View()` komutunda yer alan `View()` 
metodu bibir `VievResult` nesnesi üretecektir. Şu an için herhangi bir `View` oluşturmadığımızdan, çıktılanan `View` Visual 
Studio'nun varsayılan Viewi olacakır.
